<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데일리 챌린지</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap');

        :root {
            --bg-color: #f0f4f8; --card-bg-color: #ffffff; --text-color: #333; --subtext-color: #555;
            --border-color: #e0e0e0; --primary-color: #4a90e2; --accent-red: #e74c3c; --accent-green: #2ecc71;
            --accent-blue: #3498db; --font-family: 'Pretendard', sans-serif;
        }

        body { font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 20px; }
        .card { background-color: var(--card-bg-color); border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        
        .header { text-align: center; }
        .header h1 { font-size: 24px; margin: 0 0 4px; }
        .header #current-date { font-size: 16px; color: var(--subtext-color); }
        
        #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; text-align: center; }
        #calendar div { padding: 4px; border-radius: 8px; font-size: 14px; position: relative; }
        #calendar .day-name { font-weight: 700; color: var(--subtext-color); font-size: 12px; }
        #calendar .day { cursor: pointer; transition: background-color 0.2s, color 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 38px; }
        #calendar .day:not(.empty):hover { background-color: #e9ecef; }
        #calendar .day.selected { background-color: var(--primary-color) !important; color: white !important; font-weight: 700; }
        #calendar .day.today .date-num { background-color: #333; color: white; border-radius: 50%; width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; }
        #calendar .day.selected .date-num { background-color: transparent; }
        #calendar .day .score { font-size: 10px; font-weight: 700; margin-top: 2px; }
        
        .score-section { display: flex; flex-direction: column; align-items: center; gap: 16px; }
        #score-display { width: 120px; height: 120px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 42px; font-weight: 700; color: #fff; transition: background-color 0.5s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .score-section h2 { font-size: 20px; text-align: center; margin: 0; }

        .category-card h3 { font-size: 18px; margin: 0 0 16px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; }
        
        /* --- Layout Fix for Horizontal Blocks --- */
        .horizontal-blocks { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .block-item { display: flex; }
        .block-item input[type="checkbox"] { display: none; }
        .block-item label { cursor: pointer; padding: 8px; border: 2px solid var(--border-color); border-radius: 12px; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: all 0.2s ease; box-sizing: border-box; min-height: 60px; }
        .block-item .item-text { font-size: 13px; font-weight: 700; text-align: center; word-break: keep-all; }
        .block-item .item-points { font-size: 12px; font-weight: 700; border-radius: 6px; color: white; padding: 1px 6px; margin-top: 5px; }
        .points-positive { background-color: var(--accent-green); }
        .points-negative { background-color: var(--accent-red); }
        .block-item input[type="checkbox"]:checked + label { border-color: var(--primary-color); background-color: #f0f8ff; }
        .block-item input[type="checkbox"]:checked + label .item-text { color: var(--primary-color); }
        
        .checklist-item { display: flex; align-items: center; padding: 10px; border-radius: 8px; margin-bottom: 8px; transition: background-color 0.2s; background-color: #f8f9fa; }
        .checklist-item.checked { background-color: #e9ecef; opacity: 0.7; }
        .checklist-item.checked label span { text-decoration: line-through; color: var(--subtext-color); }
        .checklist-item label { display: flex; align-items: center; cursor: pointer; flex-grow: 1; font-size: 15px; }
        .checklist-item input[type="checkbox"] { -webkit-appearance: none; appearance: none; background-color: #fff; margin: 0 12px 0 0; width: 1.15em; height: 1.15em; border: 0.15em solid #ccc; border-radius: 0.25em; transform: translateY(-0.075em); display: grid; place-content: center; cursor: pointer; }
        .checklist-item input[type="checkbox"]::before { content: ""; width: 0.65em; height: 0.65em; transform: scale(0); transition: 120ms transform ease-in-out; box-shadow: inset 1em 1em var(--primary-color); transform-origin: bottom left; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); }
        .checklist-item input[type="checkbox"]:checked::before { transform: scale(1); }
        .checklist-item input[type="checkbox"]:checked { border-color: var(--primary-color); }
        .checklist-item .points { font-weight: 700; font-size: 16px; padding: 2px 8px; border-radius: 6px; color: white; }
        
        .study-slider-container { display: flex; flex-direction: column; align-items: center; gap: 15px; padding-top: 10px; }
        #study-slider { width: 100%; -webkit-appearance: none; appearance: none; height: 8px; background: #ddd; border-radius: 5px; outline: none; transition: opacity .2s; }
        #study-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: var(--accent-blue); border-radius: 50%; cursor: pointer; border: 3px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        #study-slider::-moz-range-thumb { width: 24px; height: 24px; background: var(--accent-blue); border-radius: 50%; cursor: pointer; border: 3px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        .slider-output { font-size: 16px; font-weight: 700; color: var(--subtext-color); width: 100%; text-align: center; }
        #study-hours-display { color: var(--accent-blue); font-size: 18px; }
        #study-points-display { color: #fff; background-color: var(--accent-blue); padding: 2px 8px; border-radius: 6px; font-size: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card header"> <h1>데일리 챌린지</h1> <p id="current-date"></p> </div>
        <div class="card"> <div id="calendar"></div> </div>
        <div class="card score-section"> <div id="score-display">29</div> <h2>오늘의 점수</h2> </div>
        
        <div class="card category-card" id="health-card"></div>
        <div class="card category-card" id="dopamine-card"></div>
        <div class="card category-card" id="study-card"></div>
        <div class="card category-card" id="routine-card"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const STARTING_SCORE = 29;
        const checklistData = {
            health: {
                title: "💪 건강",
                items: [
                    { id: 'eat_breakfast', text: '아침식사', points: 1 },
                    { id: 'eat_lunch', text: '점심식사', points: 1 },
                    { id: 'eat_dinner', text: '저녁식사', points: 1 },
                    { id: 'late_snack', text: '야식', points: -2 },
                    { id: 'sugar_drink', text: '당분음료', points: -5 },
                    { id: 'exercise', text: '운동', points: 6 },
                    { id: 'sleep_before_12', text: '전날 12시 이전 수면', points: 6 },
                    { id: 'wakeup_before_7', text: '7시 이전 기상', points: 6 },
                ]
            },
            dopamine: {
                title: "🧘‍♂️ 도파민 디톡스",
                items: [
                    { id: 'no_youtube', text: '유튜브', points: -6 },
                    { id: 'no_game', text: '게임', points: -6 },
                    { id: 'no_harmful', text: '유해물', points: -6 },
                    { id: 'no_community', text: '커뮤니티', points: -4 },
                    { id: 'cold_shower', text: '찬물샤워', points: 2 }
                ]
            },
            study: {
                title: "📚 공부",
                items: [
                    { id: 'study_commute_am', text: '등굣길 공부', points: 2 },
                    { id: 'study_commute_pm', text: '하굣길 공부', points: 2 }
                ],
                slider: { min: 0, max: 8, points: [0, 3, 3, 3, 3, 3, 3, 3, 3] }
            },
            routines: {
                title: "✨ 데일리 루틴",
                items: [
                    { id: 'ticktick_clear', text: 'TickTick 당일 계획 전부 수행', points: 4 },
                    { id: 'daily_journal', text: '일기 적기', points: 3 },
                    { id: 'emotion_journal', text: '감정 적기', points: 3 },
                    { id: 'meditation', text: '호흡 명상', points: 2 },
                    { id: 'plan_tomorrow', text: '전날 계획 세우기', points: 2 },
                    { id: 'skin_care', text: '피부관리 루틴', points: 2 },
                    { id: 'read_before_sleep', text: '잠들기 전 독서', points: 2 },
                    { id: 'oral_hygiene', text: '구강 위생', points: 2 }
                ]
            }
        };

        const scoreDisplay = document.getElementById('score-display');
        const currentDateEl = document.getElementById('current-date');
        const calendarEl = document.getElementById('calendar');
        
        let today = new Date();
        let selectedDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        
        function getScoreColor(score) { const p = Math.max(0,Math.min(100,score))/100; return `hsl(${p*120}, 70%, 45%)`; }
        function updateScoreColor(score) { scoreDisplay.style.backgroundColor = getScoreColor(score); }
        function formatDate(d) { return `${d.getFullYear()}년 ${d.getMonth()+1}월 ${d.getDate()}일`; }
        function getDateString(d) { return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

        function getStoredData(dateString) {
            const stored = localStorage.getItem(dateString);
            if(stored) return JSON.parse(stored);

            const initialData = { score: STARTING_SCORE, studyHours: 0, checkedItems: {} };
            Object.keys(checklistData).forEach(catKey => {
                checklistData[catKey].items?.forEach(item => initialData.checkedItems[item.id] = false);
            });
            return initialData;
        }

        function createElements() {
            // Health Card
            const healthCard = document.getElementById('health-card');
            healthCard.innerHTML = `<h3>${checklistData.health.title}</h3><div class="horizontal-blocks">${
                checklistData.health.items.map(item => `
                    <div class="block-item">
                        <input type="checkbox" id="${item.id}" data-points="${item.points}">
                        <label for="${item.id}">
                            <span class="item-text">${item.text}</span>
                            <span class="item-points ${item.points > 0 ? 'points-positive':'points-negative'}">${item.points > 0 ? '+' : ''}${item.points}</span>
                        </label>
                    </div>`).join('')
            }</div>`;

            // Dopamine Card
            const dopamineCard = document.getElementById('dopamine-card');
            dopamineCard.innerHTML = `<h3>${checklistData.dopamine.title}</h3><div class="horizontal-blocks">${
                checklistData.dopamine.items.map(item => `
                    <div class="block-item">
                        <input type="checkbox" id="${item.id}" data-points="${item.points}">
                        <label for="${item.id}">
                            <span class="item-text">${item.text}</span>
                            <span class="item-points ${item.points > 0 ? 'points-positive':'points-negative'}">${item.points > 0 ? '+' : ''}${item.points}</span>
                        </label>
                    </div>`).join('')
            }</div>`;

            // Study Card
            const studyCard = document.getElementById('study-card');
            studyCard.innerHTML = `<h3>${checklistData.study.title}</h3>
                <div id="study-checklist"></div>
                <div class="study-slider-container">
                    <input type="range" min="0" max="8" value="0" id="study-slider">
                    <div class="slider-output">
                        <span id="study-hours-display">0 시간</span> / <span id="study-points-display">+0</span>
                    </div>
                </div>`;
            const studyChecklistContainer = studyCard.querySelector('#study-checklist');
            checklistData.study.items.forEach(item => {
                studyChecklistContainer.appendChild(createChecklistItem(item));
            });
            
            // Routines Card
            const routineCard = document.getElementById('routine-card');
            routineCard.innerHTML = `<h3>${checklistData.routines.title}</h3><div id="routine-checklist"></div>`;
            const routineChecklistContainer = routineCard.querySelector('#routine-checklist');
            checklistData.routines.items.forEach(item => {
                routineChecklistContainer.appendChild(createChecklistItem(item));
            });

            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.addEventListener('change', updateScore));
            document.getElementById('study-slider').addEventListener('input', () => {
                const slider = document.getElementById('study-slider');
                const hours = slider.value;
                document.getElementById('study-hours-display').textContent = `${hours} 시간`;
                let currentStudyPoints = 0;
                for (let i = 1; i <= hours; i++) { currentStudyPoints += checklistData.study.slider.points[i]; }
                document.getElementById('study-points-display').textContent = `+${currentStudyPoints}`;
                updateScore();
            });
        }
        
        function createChecklistItem(item) {
            const div = document.createElement('div');
            div.className = 'checklist-item';
            div.innerHTML = `<label>
                <input type="checkbox" id="${item.id}" data-points="${item.points}">
                <span>${item.text}</span>
            </label>
            <span class="points points-positive">+${item.points}</span>`;
            div.querySelector('input').addEventListener('change', (e) => {
                div.classList.toggle('checked', e.target.checked);
            });
            return div;
        }

        function loadStateForDate(dateString) {
            const data = getStoredData(dateString);
            Object.keys(data.checkedItems).forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = data.checkedItems[id];
                    const parentItem = checkbox.closest('.checklist-item');
                    if(parentItem) parentItem.classList.toggle('checked', checkbox.checked);
                }
            });
            const slider = document.getElementById('study-slider');
            slider.value = data.studyHours || 0;
            slider.dispatchEvent(new Event('input'));
        }

        function updateScore() {
            let score = STARTING_SCORE;
            const checkedItems = {};

            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                checkedItems[cb.id] = cb.checked;
                if(cb.checked) { score += parseInt(cb.dataset.points); }
            });
            
            const slider = document.getElementById('study-slider');
            const studyHours = parseInt(slider.value);
            let currentStudyPoints = 0;
            for (let i = 1; i <= studyHours; i++) {
                currentStudyPoints += checklistData.study.slider.points[i];
            }
            score += currentStudyPoints;
            
            scoreDisplay.textContent = score;
            updateScoreColor(score);
            
            const dateString = getDateString(selectedDate);
            localStorage.setItem(dateString, JSON.stringify({ score, studyHours, checkedItems }));
            
            renderCalendarScores();
        }

        function renderCalendar() {
            calendarEl.innerHTML = '';
            const year = selectedDate.getFullYear(), month = selectedDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayOfMonth = new Date(year, month, 1).getDay();

            ['일','월','화','수','목','금','토'].forEach(name => {
                const dayNameEl = document.createElement('div');
                dayNameEl.className = 'day-name';
                dayNameEl.textContent = name;
                calendarEl.appendChild(dayNameEl);
            });

            for (let i = 0; i < firstDayOfMonth; i++) calendarEl.appendChild(document.createElement('div'));

            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                const dayDate = new Date(year, month, i);
                const dateString = getDateString(dayDate);
                
                dayEl.className = 'day';
                dayEl.dataset.date = dateString;
                dayEl.innerHTML = `<span class="date-num">${i}</span><span class="score"></span>`;
                
                if (dateString === getDateString(selectedDate)) dayEl.classList.add('selected');
                if (dateString === getDateString(new Date())) dayEl.classList.add('today');
            
                dayEl.addEventListener('click', () => {
                    selectedDate = dayDate;
                    currentDateEl.textContent = formatDate(selectedDate);
                    document.querySelectorAll('.day.selected').forEach(d => d.classList.remove('selected'));
                    dayEl.classList.add('selected');
                    loadStateForDate(dateString);
                });
                calendarEl.appendChild(dayEl);
            }
            renderCalendarScores();
        }
        
        function renderCalendarScores() {
             document.querySelectorAll('.day[data-date]').forEach(dayEl => {
                const dateString = dayEl.dataset.date;
                const data = getStoredData(dateString);
                const scoreEl = dayEl.querySelector('.score');
                scoreEl.textContent = data.score;
                const isPristine = data.score === STARTING_SCORE;
                if (!isPristine) { scoreEl.style.color = getScoreColor(data.score); }
                else { scoreEl.style.color = 'inherit'; }
            });
        }
        
        function initializeApp() {
            currentDateEl.textContent = formatDate(selectedDate);
            createElements();
            renderCalendar();
            loadStateForDate(getDateString(selectedDate));
        }

        initializeApp();
    });
    </script>
</body>
</html>